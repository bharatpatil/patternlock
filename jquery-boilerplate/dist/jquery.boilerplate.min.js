/*
 *  jQuery Boilerplate - v3.3.1
 *  A jump-start for jQuery plugins development.
 *  http://jqueryboilerplate.com
 *
 *  Made by Zeno Rocha
 *  Under MIT License
 */
!function(a,b,c,d){function e(b,c){this.element=b,this.started=!1,this.nums=[],this.arrCoordinates=[],this.patternClearTimeout=null,this.canvas=null,this.canvasContext=null,this.options=a.extend({},k,c),this._defaults=k,this._name=j,this.init()}var f,g,h,i,j="patternLock",k={rows:3,columns:3,width:250,height:250,randomizeIds:!1,isCircle:!0,showPatternLine:!0,patternLineColor:"#000000",fieldName:"",valueSeparator:",",valueArray:[],centerCircle:!1,lineWidth:4,centerCircleSize:10},l=function(){var a=c.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}();e.prototype={init:function(){var b=this;if(0===this.options.valueArray.length||this.options.valueArray.length!==this.options.rows*this.options.columns)for(f=0;f<this.options.rows*this.options.columns;f++)this.options.valueArray[f]=f+1;var c='<div class="patternlock" style="width:'+this.options.width+"px;height:"+this.options.height+'px"><div class="insideWrapper">';for(this.options.fieldName!=d&&""!==this.options.fieldName&&null!=this.options.fieldName&&(c+='<input type="hidden" name="'+this.options.fieldName+'">'),l===!0&&this.options.showPatternLine===!0&&(c+='<canvas class="patternLockCanvas" width="100%" height="100%;"></canvas>'),c+='<table class="tbl tbl1" cellspacing="25px">',h=0,f=1;f<=this.options.rows;f++){for(c+="<tr>",g=1;g<=this.options.columns;g++)c=c+'<td class="lockTd cell-'+this.options.valueArray[h]+'" data-value="'+this.options.valueArray[h]+'">',this.options.centerCircle&&(c=c+'<div class="centerCircle cir-'+this.options.valueArray[h++]+'" style="width:'+this.options.centerCircleSize+"px;height:"+this.options.centerCircleSize+'px">&nbsp;</div>'),c+="</td>";c+="</tr>"}c+="</table></div></div>",a(this.element).append(c),l===!0&&this.options.showPatternLine===!0&&(b.canvas=a(".patternLockCanvas",this.element)[0],b.canvas.width=this.options.width,b.canvas.height=this.options.width,b.canvasContext=b.canvas.getContext("2d")),this.bindEvents()},bindEvents:function(){var b=this;a("td.lockTd",this.element).bind("mouseenter",function(a){a.preventDefault(),b.lockMoveMouse(this)}),a("td.lockTd",this.element).bind("mousedown",function(){b.patternClearTimeout&&(clearTimeout(b.patternClearTimeout),b.clearSelection()),b.lockStartMouse(a(this))}),a(".tbl",this.element).bind("touchmove",function(c){c.preventDefault(),i=a(this);var d=c.originalEvent.touches[0]||c.originalEvent.changedTouches[0],e=d.pageX,f=d.pageY;b.lockMoveTouch(i,e,f)}),a(".tbl",this.element).bind("touchstart",function(c){b.patternClearTimeout&&(clearTimeout(b.patternClearTimeout),b.clearSelection());var d=c.originalEvent.touches[0]||c.originalEvent.changedTouches[0],e=d.pageX,f=d.pageY;c.preventDefault(),i=a(this),b.lockStartTouch(i,e,f)}),a(".tbl",this.element).bind("mouseup touchend",function(a){a.preventDefault(),b.pattenDrawEnd()}),a(c).bind("mouseup touchend",function(){b.pattenDrawEnd()})},lockStartMouse:function(b){this.started=!0,this.nums=[],this.arrCoordinates=[],a(b).removeClass("selected"),this.clearCanvas(),a(b).addClass("selected"),this.nums.push(a(b).attr("data-value")),this.arrCoordinates.push(this.getCenter(b))},lockMoveMouse:function(b){var c=a(b).attr("data-value"),d=this.nums[this.nums.length-1];this.started===!0&&d!==c&&(this.arrCoordinates.push(this.getCenter(b)),this.drawLine(),a(b).addClass("selected"),this.nums.push(a(b).attr("data-value")))},lockStartTouch:function(b,c,d){var e=null,f=this;a("td.lockTd",b).each(function(){return f.isMouseOverLockHoles(a(this),c,d)?(e=a(this),f.started=!0,f.nums=[],f.arrCoordinates=[],f.clearCanvas(),a(e).addClass("selected"),f.nums.push(a(e).attr("data-value")),void f.arrCoordinates.push(f.getCenter(e))):void 0})},lockMoveTouch:function(b,c,d){var e=null,f=this;a("td.lockTd",b).each(function(){if(f.isMouseOverLockHoles(a(this),c,d)){e=a(this);var b=a(e).attr("data-value"),g=f.nums[f.nums.length-1];return void(f.started===!0&&g!==b&&(f.arrCoordinates.push(f.getCenter(e)),f.drawLine(),a(e).addClass("selected"),f.nums.push(a(e).attr("data-value"))))}})},isInsideCircle:function(a,b,c,d,e){return Math.sqrt(Math.pow(d-a,2)+Math.pow(e-b,2))<=c},getCenter:function(b){if(l!==!1&&this.options.showPatternLine!==!1){{var c=a(b).position(),d=a(b).outerWidth(),e=a(b).outerHeight(),f=c.left+d/2,g=c.top+e/2;this.canvas.getBoundingClientRect()}return{x:f,y:g}}},clearCanvas:function(){if(l!==!1&&this.options.showPatternLine!==!1){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);var a=this.canvas.width;this.canvas.width=1,this.canvas.width=a}},drawLine:function(){if(!(l===!1||this.options.showPatternLine===!1||this.arrCoordinates.length<2)){var a=this.arrCoordinates;f=a.length-1,this.canvasContext.lineWidth=this.options.lineWidth,this.canvasContext.beginPath(),this.canvasContext.moveTo(a[f-1].x,a[f-1].y),this.canvasContext.lineTo(a[f].x,a[f].y),this.canvasContext.strokeStyle=this.options.patternLineColor,this.canvasContext.stroke(),this.canvasContext.closePath()}},pattenDrawEnd:function(){if(this.started===!0){this.started=!1,this.patternClearTimeout&&clearTimeout(this.patternClearTimeout);var b=this;this.patternClearTimeout=setTimeout(function(){b.clearSelection()},500);var c=this.nums.join(this.options.valueSeparator);this.options.fieldName!=d&&""!==this.options.fieldName&&null!=this.options.fieldName&&a("input[type=hidden][name="+this.options.fieldName+"]").val(c),this.options.drawEnd&&this.options.drawEnd.call(null,c)}},clearSelection:function(){a(".tbl td",this.element).removeClass("selected"),this.clearCanvas()},isMouseOverLockHoles:function(a,b,c){var d=a.offset();if(this.options.isCircle===!0){var e=a.width()/2;return this.isInsideCircle(d.left+e,d.top+e,e,b,c)}return c>=d.top&&b>=d.left&&b<=d.left+a[0].offsetWidth&&c<=d.top+a[0].offsetHeight}},a.fn[j]=function(b){return this.each(function(){a.data(this,"plugin_"+j)||a.data(this,"plugin_"+j,new e(this,b))})}}(jQuery,window,document);