/*
 *  jQuery Boilerplate - v3.3.1
 *  A jump-start for jQuery plugins development.
 *  http://jqueryboilerplate.com
 *
 *  Made by Zeno Rocha
 *  Under MIT License
 */
!function(a,b,c,d){function e(b,c){i=this,this.element=b,this.started=!1,this.nums=[],this.arrCoordinates=[],this.patternClearTimeout=null,this.canvas=null,this.canvasContext=null,this.options=a.extend({},l,c),this._defaults=l,this._name=k,this.init()}var f,g,h,i,j,k="patternLock",l={rows:3,columns:3,width:250,height:250,randomizeIds:!1,isCircle:!0,showPatternLine:!0,patternLineColor:"#000000",fieldName:"",valueSeparator:",",valueArray:[],centerCircle:!1,lineWidth:4,centerCircleSize:10},m=function(){var a=c.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}();e.prototype={init:function(){if(0===this.options.valueArray.length||this.options.valueArray.length!==this.options.rows*this.options.columns)for(f=0;f<this.options.rows*this.options.columns;f++)this.options.valueArray[f]=f+1;var b='<div class="patternlock" style="width:'+this.options.width+"px;height:"+this.options.height+'px"><div class="insideWrapper">';for(this.options.fieldName!=d&&""!==this.options.fieldName&&null!=this.options.fieldName&&(b+='<input type="hidden" name="'+this.options.fieldName+'">'),m===!0&&this.options.showPatternLine===!0&&(b+='<canvas class="patternLockCanvas" width="100%" height="100%;"></canvas>'),b+='<table class="tbl tbl1" cellspacing="25px">',h=0,f=1;f<=this.options.rows;f++){for(b+="<tr>",g=1;g<=this.options.columns;g++)b=b+'<td data-value="'+this.options.valueArray[h++]+'">',this.options.centerCircle&&(b=b+'<div class="centerCircle" style="width:'+this.options.centerCircleSize+"px;height:"+this.options.centerCircleSize+'px">&nbsp;</div>'),b+="</td>";b+="</tr>"}b+="</table></div></div>",a(this.element).append(b),m===!0&&this.options.showPatternLine===!0&&(i.canvas=a(".patternLockCanvas",this.element)[0],i.canvas.width=this.options.width,i.canvas.height=this.options.width,i.canvasContext=i.canvas.getContext("2d")),a(".tbl").on("vmousemove",function(b){b.preventDefault(),j=a(this),a("td",j).each(function(){if(i.isMouseOverLockHoles(a(this),b.pageX,b.pageY)){var c=a(this).attr("data-value"),d=i.nums[i.nums.length-1];i.started===!0&&d!==c&&(i.arrCoordinates.push(i.getCenter(this)),i.drawLine(),a(this).addClass("selected"),i.nums.push(a(this).attr("data-value")))}})}),a(".tbl").on("vmouseup",function(a){a.preventDefault(),i.pattenDrawEnd()}),a(c).on("vmouseup",function(){i.pattenDrawEnd()}),a(".tbl").on("vmousedown",function(b){i.patternClearTimeout&&clearTimeout(i.patternClearTimeout),b.preventDefault(),j=a(this),a("td",j).each(function(){i.isMouseOverLockHoles(a(this),b.pageX,b.pageY)&&(i.started=!0,i.nums=[],i.arrCoordinates=[],a("td",j).removeClass("selected"),i.clearCanvas(),a(this).addClass("selected"),i.nums.push(a(this).attr("data-value")),i.arrCoordinates.push(i.getCenter(this)))})})},yourOtherFunction:function(){},isInsideCircle:function(a,b,c,d,e){return Math.sqrt(Math.pow(d-a,2)+Math.pow(e-b,2))<=c},getCenter:function(b){if(m!==!1&&this.options.showPatternLine!==!1){var c=a(b).offset(),d=a(b).outerWidth(),e=a(b).outerHeight(),f=c.left+d/2,g=c.top+e/2,h=i.canvas.getBoundingClientRect();return f-=h.left,g-=h.top,{x:f,y:g}}},clearCanvas:function(){if(m!==!1&&this.options.showPatternLine!==!1){i.canvasContext.clearRect(0,0,i.canvas.width,i.canvas.height);var a=i.canvas.width;i.canvas.width=1,i.canvas.width=a}},drawLine:function(){if(!(m===!1||this.options.showPatternLine===!1||i.arrCoordinates.length<2)){var a=i.arrCoordinates;f=a.length-1,i.canvasContext.lineWidth=this.options.lineWidth,i.canvasContext.beginPath(),i.canvasContext.moveTo(a[f-1].x,a[f-1].y),i.canvasContext.lineTo(a[f].x,a[f].y),i.canvasContext.strokeStyle=this.options.patternLineColor,i.canvasContext.stroke(),i.canvasContext.closePath()}},pattenDrawEnd:function(){i.started===!0&&(a("#pattern").text(i.nums.join(",")),this.options.fieldName!=d&&""!==this.options.fieldName&&null!=this.options.fieldName&&a("input[type=hidden][name="+this.options.fieldName+"]").val(i.nums.join(this.options.valueSeparator)),i.started=!1,i.patternClearTimeout&&clearTimeout(i.patternClearTimeout),i.patternClearTimeout=setTimeout(function(){a(".tbl td").removeClass("selected"),i.clearCanvas()},1e3))},isMouseOverLockHoles:function(a,b,c){var d=a.offset();if(this.options.isCircle===!0){var e=a.width()/2;return this.isInsideCircle(d.left+e,d.top+e,e,b,c)}return c>=d.top&&b>=d.left&&b<=d.left+a[0].offsetWidth&&c<=d.top+a[0].offsetHeight}},a.fn[k]=function(b){return this.each(function(){a.data(this,"plugin_"+k)||a.data(this,"plugin_"+k,new e(this,b))})}}(jQuery,window,document);