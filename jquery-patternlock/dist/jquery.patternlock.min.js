/*
 *  Pattern Lock - v1.0.0
 *  Android like pattern lock for web with touch event support
 *  
 *
 *  Made by Bharat Patil
 *  Under CustomLicense License
 */
!function(a,b,c,d){function e(b,c){this.element=b,this.started=!1,this.nums=[],this.arrCoordinates=[],this.patternClearTimeout=null,this.canvas=null,this.canvasContext=null,this.selectionClass="myselectionClass"+(new Date).getTime(),this.selectionClassStyle="."+this.selectionClass,this.options=a.extend({},l,c),this._defaults=l,this._name=k,this.init()}var f,g,h,i,j,k="patternLock",l={rows:3,columns:3,width:250,height:250,randomizeIds:!1,isCircle:!0,showPatternLine:!0,patternLineColor:"#000000",fieldName:"",valueSeparator:",",valueArray:[],centerCircle:!1,lineWidth:4,centerCircleSize:10,drawEnd:null,selectionColor:"#0000ff",timeout:500,allowRepeatSelection:!1},m=function(){var a=c.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),n='<style id="patternLockStyylee"></style>';e.prototype={init:function(){this.initIESupport(),0===a("#patternLockStyylee").length&&a(n).appendTo("head");try{this.selectionClassStyle+="{ background-color: "+this.options.selectionColor+" !important; }",a("#patternLockStyylee").append(this.selectionClassStyle)}catch(b){this.selectionClass="ie8FallbackHighlight"}var c=this;if(0===this.options.valueArray.length||this.options.valueArray.length!==this.options.rows*this.options.columns)for(f=0,j=this.options.rows*this.options.columns;j>f;f++)this.options.valueArray[f]=f+1;var d='<div class="patternlock" style="width:'+this.options.width+"px;height:"+this.options.height+'px"><div class="insideWrapper">';for(a.isEmptyObject(this.options.fieldName)===!1&&(d+='<input type="hidden" name="'+this.options.fieldName+'">'),m===!0&&this.options.showPatternLine===!0&&(d+='<canvas class="patternLockCanvas" width="100%" height="100%;"></canvas>'),d+='<table class="tbl tbl1" cellspacing="25px">',h=0,f=1;f<=this.options.rows;f++){for(d+="<tr>",g=1;g<=this.options.columns;g++)d=d+'<td class="lockTd cell-'+this.options.valueArray[h]+'" data-value="'+this.options.valueArray[h]+'">',this.options.centerCircle&&(d=d+'<div class="centerCircle cir-'+this.options.valueArray[h]+'" style="width:'+this.options.centerCircleSize+"px;height:"+this.options.centerCircleSize+'px"></div>'),h++,d+="</td>";d+="</tr>"}d+="</table>",d+="</div></div>",a(this.element).append(d);var e=a("table.tbl",this.element).outerWidth(),i=a("table.tbl",this.element).outerHeight(),k=a(".patternlock",this.element);e>this.options.width&&(this.options.width=e),i>this.options.height&&(this.options.height=i),k.css({width:this.options.width,height:this.options.height}),m===!0&&this.options.showPatternLine===!0&&(c.canvas=a(".patternLockCanvas",this.element)[0],c.canvas.width=this.options.width,c.canvas.height=this.options.height,c.canvasContext=c.canvas.getContext("2d")),this.bindEvents()},initIESupport:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1})},bindEvents:function(){var b=this;a("td.lockTd",this.element).bind("mouseenter",function(a){a.preventDefault(),b.lockMoveMouse(this)}),a("td.lockTd",this.element).bind("mousedown",function(){b.patternClearTimeout&&(clearTimeout(b.patternClearTimeout),b.clearSelection()),b.lockStartMouse(this)}),a(".tbl",this.element).bind("touchmove",function(c){c.preventDefault(),i=a(this);var d=c.originalEvent.touches[0]||c.originalEvent.changedTouches[0],e=d.pageX,f=d.pageY;b.lockMoveTouch(i,e,f)}),a(".tbl",this.element).bind("touchstart",function(c){b.patternClearTimeout&&(clearTimeout(b.patternClearTimeout),b.clearSelection());var d=c.originalEvent.touches[0]||c.originalEvent.changedTouches[0],e=d.pageX,f=d.pageY;c.preventDefault(),i=a(this),b.lockStartTouch(i,e,f)}),a(".tbl",this.element).bind("mouseup touchend",function(a){a.preventDefault(),b.pattenDrawEnd()}),a(c).bind("mouseup touchend",function(){b.pattenDrawEnd()})},lockStartMouse:function(b){this.started=!0,this.nums=[],this.arrCoordinates=[],a(b).removeClass("selected "+this.selectionClass),this.clearCanvas(),a(b).addClass("selected "+this.selectionClass),this.nums.push(a(b).attr("data-value")),this.arrCoordinates.push(this.getCenter(b))},lockMoveMouse:function(b){var c=a(b).attr("data-value"),d=this.nums[this.nums.length-1];this.started!==!0||d===c||!this.options.allowRepeatSelection&&-1!==this.nums.indexOf(c)||(this.arrCoordinates.push(this.getCenter(b)),this.drawLine(),a(b).addClass("selected "+this.selectionClass),this.nums.push(a(b).attr("data-value")))},lockStartTouch:function(b,c,d){var e=null,f=this;a("td.lockTd",b).each(function(){return f.isMouseOverLockHoles(a(this),c,d)?(e=a(this),f.started=!0,f.nums=[],f.arrCoordinates=[],f.clearCanvas(),a(e).addClass("selected "+f.selectionClass),f.nums.push(a(e).attr("data-value")),void f.arrCoordinates.push(f.getCenter(e))):void 0})},lockMoveTouch:function(b,c,d){var e=null,f=this;a("td.lockTd",b).each(function(){if(f.isMouseOverLockHoles(a(this),c,d)){e=a(this);var b=a(e).attr("data-value"),g=f.nums[f.nums.length-1];return void(f.started!==!0||g===b||!f.options.allowRepeatSelection&&-1!==f.nums.indexOf(b)||(f.arrCoordinates.push(f.getCenter(e)),f.drawLine(),a(e).addClass("selected "+f.selectionClass),f.nums.push(a(e).attr("data-value"))))}})},isInsideCircle:function(a,b,c,d,e){return Math.sqrt(Math.pow(d-a,2)+Math.pow(e-b,2))<=c},getCenter:function(b){if(m!==!1&&this.options.showPatternLine!==!1){var c=a(b).position(),d=a(b).outerWidth(),e=a(b).outerHeight(),f=c.left+d/2,g=c.top+e/2;return{x:f,y:g}}},clearCanvas:function(){if(m!==!1&&this.options.showPatternLine!==!1){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);var a=this.canvas.width;this.canvas.width=1,this.canvas.width=a}},drawLine:function(){if(!(m===!1||this.options.showPatternLine===!1||this.arrCoordinates.length<2)){var a=this.arrCoordinates;f=a.length-1,this.canvasContext.lineWidth=this.options.lineWidth,this.canvasContext.beginPath(),this.canvasContext.moveTo(a[f-1].x,a[f-1].y),this.canvasContext.lineTo(a[f].x,a[f].y),this.canvasContext.strokeStyle=this.options.patternLineColor,this.canvasContext.stroke(),this.canvasContext.closePath()}},pattenDrawEnd:function(){if(this.started===!0){this.started=!1,this.patternClearTimeout&&clearTimeout(this.patternClearTimeout);var b=this;this.patternClearTimeout=setTimeout(function(){b.clearSelection()},b.options.timeout);var c=this.nums.join(this.options.valueSeparator);a.isEmptyObject(this.options.fieldName)===!1&&a("input[type=hidden][name="+this.options.fieldName+"]").val(c),this.options.drawEnd&&a.isFunction(this.options.drawEnd)&&this.options.drawEnd.call(null,c)}},clearSelection:function(){a(".tbl td",this.element).removeClass("selected "+this.selectionClass),this.clearCanvas()},isMouseOverLockHoles:function(a,b,c){var d=a.offset();if(this.options.isCircle===!0){var e=a.width()/2;return this.isInsideCircle(d.left+e,d.top+e,e,b,c)}return c>=d.top&&b>=d.left&&b<=d.left+a[0].offsetWidth&&c<=d.top+a[0].offsetHeight}},a.fn[k]=function(b){return b===d||"object"==typeof b?this.each(function(){a.data(this,"plugin_"+k)||a.data(this,"plugin_"+k,new e(this,b))}):"string"==typeof b&&"_"!==b[0]&&"init"!==b?(this.each(function(){"destroy"===b&&(a.data(this,"plugin_"+k,null),a(this).empty())}),this):void 0}}(jQuery,window,document);